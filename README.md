В рамках 5-го домашнего задания нами будет реализован еще один кастомный обработчик изображений. Его основное отличие от всех остальных заключается в том, что он предполагает интеграцию со сторонней, неподконтрольной нам, системой для определения объектов на изображении.

### Обработчик изображений
Для определения объектов на изображении я предлагаю использовать сервис Imagga. Его API достаточно прост, а также он предлагает бесплатный пробный план с 1000 запросов для тестирования АПИ.

Логика работы обработчика следующая:

* Загрузить изображение в Imagga через POST <https://api.imagga.com/v2/uploads>.
* Выполнить запрос GET <https://api.imagga.com/v2/tags(/<tagger_id>)>, чтобы получить список тэгов по изображению.
* Выбрать топ-3 тэга с самой высокой вероятностью и добавить их на изображение. Для этого можно использовать один из вариантов (или свой собственный):
  * https://www.baeldung.com/java-add-text-to-image
  * https://stackoverflow.com/questions/10929524/how-to-add-text-to-an-image-in-java
* Выгрузить изображение в AWS и закончить его обработку.

### Выполнение и обработка запросов

В качестве веб-клиента вы вольны использовать любой (хорошая дока Spring). Однако нужно учесть два следующих момента:
* Сервис не наш, и его SLA нам не известен. Запросы могут обрабатываться долго, сам сервис может лежать, или не выдержать нашего RPS и отвалиться.
* У сервиса есть лимит на кол-во запросов, которые мы к нему можем отправить в бесплатной подписке.

Для решения обеих проблем я предлагаю вам в проекте использовать Retry, Circuit Breaker и Rate Limiter.

**Retry** нужен нам для того, чтобы иметь возможность повторно выполнить запрос в случае его завершения с ошибкой. Однако нужно понимать, что не каждый запрос стоит ретраить. К примеру ретрай 404, 401 или 400 ошибки вряд ли приведет к другим результатам. Поэтому в проекте я предлагаю ретраить 429 и 5хх ошибки.

**Circuit Breaker** позволит нам избежать повторного выполнения запросов в случае, когда нам известно, что сервис в любом случае не ответит или ответит ошибкой. К примеру при его рестарте.

**Rate Limiter** позволит нам контролировать, какое реальное кол-во запросов мы будем отправлять в Imagga и обрабатывать от наших пользователей. То есть, данный компонент должен быть установлен в двух местах:
* В API, чтобы гарантировать, что один пользователь за 10 секунд не исчерпает весь наш лимит в 1000 запросов.
* В обработчике, чтобы
  * … заранее понимать, не дошли ли мы до лимита стороннего API
  * … не исчерпать лимит раньше времени
  * … не выполнять ненужных запросов (которые и так завершатся ошибкой), когда мы достигнем лимита

По какому признаку стоит ограничивать кол-во запросов (N запросов всего или M запросов от одного конкретного пользователя) - решать вам. Не забудьте учесть, что у вас несколько инстансов, а лимит должен быть общим.

Для реализации данных компонентов я предлагаю использовать вам следующие библиотеки:
* resilience4j
* bucket4j
* Spring Retry
